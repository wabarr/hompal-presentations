---
title: Basic Intro to R
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
author: Andrew Barr
---

```{r loadpackage, include=FALSE}
library(learnr)
```

```{r setup, include=FALSE}
femur <- c(450.8,444.8,415.1,487.3,349,459.5,431.7,454.1,420.6,387.2)
tibia <- c(337.7,336.7,333.9,356.6,356.8,361.7,373.3,338.4,379.4,370.9)
```

## Interactive R

### A very complicated calculator

The most basic way to interact with R is to use it like a calculator. Type `2 + 2` and then click the 'Run Code' button.  Instead of clicking the button, you can also hit CTRL + Enter (Windows) or Command + Enter (Mac). Later, when you run R code on your own computer, you can just hit Enter. 

```{r calculator, exercise=T}

```

You should see your result appear, saying `[1] 4`. Don't worry about the `[1]` part yet (we will get there). 


### Congrats! 

You are now using R, and you know the answer to 2 + 2 ;-)

For this tutorial you will enter commands directly into your browser.  Later, we will open the R interpreter on your computer and and we will see how you can save a complicated series of commands to a script file and execute them automatically. 

## Assignment {.build}

### Storing values for later

Sometimes it is useful to assign the results of computations to a named variable that we will use later.

We can create a named variable using the `<-` assignment operator.  It is called 'assignment' because you are assigning a specific value to a specific named object.

**Note** It is technically possible to use the `=` symbol for assignment, but this is bad form.  Get used to typing the `<-` symbol.  

```{r}
myVariable <- 2 + 3
```

Now the result from this computation is assigned to `myVariable` and saved for later use.  Later, we can call this  variable like so: 

```{r}
myVariable * myVariable
```

### Challenge

Use the interpreter below to assign the value 17 to the variable `apple`, and assign the value 63 to the variable `banana`, then use the interpreter to divide `banana` by `apple`. Note: you can type multiple lines of code in the box before you hit "Run Code" to actually do the calculations.  

```{r myvariable, exercise=T}

```


## Are you lost?

Talk to some members of your small group! You can share screens, chat, etc within the breakout room, so chances are somebody can help you!


## Atomic vectors {.build}

### The basics

An atomic vector is a series of values stored together in a single object.  

You can create a vector using the `c()` function (**c** stands for **combine**). 

**Note**: you can only store a single type of data in a vector (e.g. numeric data or text data).

For example, here are some (fake) measurements of human tibiae and femora, in millimeters.

```{r}
femur
tibia
```

### Challenge

use the `c()` function to create a vector containing the words "DC", "Maryland", and "Virginia". 

Hint: if your code runs without an error message, then it worked! That's often the case in R when it works, it can be a bit underwhelming!

```{r makeavector, exercise=TRUE}
```

### Vectorization

Many of the basic functions and operations in R are **vectorized**, meaning that they operate on all elements of a vector in sequence. 

To sum the elements of two vectors together, you can just add them like they are numbers, because the `+` function is vectorized. 

This is one of the fundamental advantages of R, which you will grow to appreciate over time (I promise)!

### Challenge

If we wanted to calculate an approximate leg length for each individual in our dataset, we can just add the `femur` and `tibia` vectors together. Try it below!

```{r leglength, exercise=T, exercise.setup="femurtibia"}
```

You will see that the result of adding these two variables is the summed tibia and femur length for each individual.  Under the hood, R has added the vectors element-by-element, summing the first tibia length with the first femur length, the second tibia length with the second femur length, and so on. 

### What happens when I mix numbers with text in a vector??

```{r badnews, exercise=T, exercise.eval=T }
badnews <- c(21,22,23,24,25,26,27,28,29,"thirty")
```

What type of data is now contained in is `badnews`?

Add a new line to the code above to see what happens if you try to add `badnews` + `tibia`?

<div id="badnews-hint">Hint: you should get an error saying "non-numeric argument to binary operator" when you add `badnews + tibia`. That is expected! It makes no sense to try to add a number and a bit of text!?</div>

## Accessing values within a vector {.build}

### Indexing

Vectors can be **indexed** with brackets `[]` to get a subset of values.

Recall the `femur` variable, which contains 10 distinct numbers in it.

```{r}
femur
```

If I type `femur[2]` then I get back only the second element in the `femur` vector.

```{r}
femur[2]
```

### getting more than one value back

You can also request back more than one value.  Here are two equivalent ways to get the second through the fifth elements of the `femur` vector.

```{r extractmultiple, exercise=TRUE}
femur[c(2,3,4,5)]
femur[2:5]
#note, the : symbol is a quick way to make a series of integers
```

### Challenge 

In a single line of code, extract the first, fifth, and ninth element of the `tibia` vector.

```{r challengeextractmultiple, exercise=T}
```

### Negative Indexing {.build}

When you use negative indices, then the referenced elements are **removed** from the resulting vector. 

```{r}
dwarves <- c("Dopey", "Gimli", "Larry")
dwarves[-3] #real dwarves
```

**Note**: comments using the octothorpe (AKA the hashtag #) are for meat people to read, not computers.  

### Challenge 


Remove the 1st, 5th and 9th elements from `femur`

```{r removeelements, exercise=T}
```

## Logical Tests

### Making assertions

Logical tests are assertions that R evaluates as either `TRUE` or `FALSE`. 

For instance, you might assert that "1 plus 1 equals 10 minus 8"? 

In R that looks like:

```{r}
1 + 1 == 10 - 8
```

R tells us that this is `TRUE`.  

Note the double equals symbol, which means something different than a single equals symbol.

### The logical operators

The logical operators are:

*  `==` is equal to
*  `!=` does not equal
*  `>` greater than
*  `<` less than
*  `>=` greater than or equal to
*  `<=` less than or equal to

### Logical indexing

Like most things in R, logical tests work on vectors. 

Remember `femur` from before? 

```{r}
femur
```

Lets find out which values are greater than 450 mm. Note that we are asserting that every value of the `femur` vector is larger than 450.  R goes through element by element and reports whether our assertion is TRUE or FALSE.  

```{r smallfems, exercise=T}
femur > 450
```

### Logical indexing 

This becomes really useful when you want a subset of values from a vector that meet some condition

To get **only** the values of `femur` that are greater than 450, we can use a logical (AKA boolean) vector.

```{r subsetfemur, exercise=TRUE, exercise.setup="femurtibia"}
femur[femur > 450] 
```

Note: when you index a vector with another logical vector, you get back ONLY those cases where the value is `TRUE`.  

### It ain't just text

Note that `TRUE` and `FALSE` are special values in R. They are not just text variables. Only text variables require quotation marks, so when you type `TRUE` and `FALSE` you don't need quotes. Just like EVERYTHING in R, capitalization matters. Try this on for size:

```{r trueaintTRUE, exercise=TRUE}
"TRUE" == TRUE
```

### Summing logical vectors

Its a handy trick to calculate the sum of a logical vector using the `sum()` function.  When you do this, R treats `TRUE` as 1 and `FALSE` as 0.  So if I want to count the number of femora greater than 450mm I can just to this:

```{r summingfemora, exercise=TRUE}
```

### Getting all fancy with logical indexing

You can also pass complicated logical tests using the AND operator `&` or the logical OR operator `|`

```{r complexfemur, exercise=T, exercise.setup="femurtibia"}
femur[femur > 450 & femur < 460]
femur[femur > 450 | tibia < 330]
```

## Assignment & Indexing {.build }

### Replacing elements

You can also use `<-` to replace particular elements in a vector. Suppose we have a vector of primates: 

```{r primates, exercise=TRUE, exercise.eval=TRUE}
primates <- c("gorilla", "gibbon", "langur", "gibbon", "gorilla")
primates
```

We can replace the third element of this vector like so:

```{r}
primates[3] <- "bushbaby"
primates
```


### Challenge 

Replace all instances of 'gorilla' with 'chimpanzee' in the `primates` vector, making use of logical indexing.

```{r replacegorillas, exercise=T}

```

## Factors {.build}

### Categorical data type

A factor is a special type of vector for storing categorical data.  


```{r}
pets <- factor(c("cat", "cat", "dog", "pony", "dog", "dog"))
pets
```

R will now treat this differently from other vectors.

These come in useful later on, when we want to summarize by different factor levels.  

### Ordered factors {.build}

By default, R assumes the order of the levels in your factor is alphabetical.

You can change this by replacing the normal factor `pets` with a new ***ordered*** factor

```{r}
pets <- ordered(pets, levels=c("pony", "dog", "cat"))
pets
```

## Data Frames {.build}

### The workhorse data structure of R

Data frames store related vectors of data together in a single object.

They are analogous to a spreadsheet:

> - each row corresponds to an individual (e.g., specimen, species)
> - each column corresponds to some observation about that individual

You will use the `read.table()` function to read a dataframe directly from a .csv or .txt file

### Accessing data in a dataframe {.build}


`$` is used to access a named column within an dataframe

The `[row, column]` syntax is used to identify the index number of the row and column desired

Lets extract particular data within the built-in dataframe `iris`

```{r}
head(iris)
```

### Getting data by named column 

```{r}

iris$Sepal.Length

```

### Getting data by row and column number

```{r}
iris[1,3]

```

### Challenge

Extract the 15th element of the 2nd row of the `iris` dataframe.

```{r irisextract, exercise=TRUE}
```

### Getting a whole row of data {.build}

```{r}
iris[1, ]
```

Note that leaving a blank indicates ALL rows or columns.  

So `iris$Species` is the same as `iris[,5]` because the fifth column of the `iris` dataframe is named 'Species'

### Creating a new column with `$` {.build}

You can also create new columns in a dataframe using the `$` operator. 

There is no columm names `Petal.Area`

```{r}
iris$Petal.Area
```

### Challenge

Add a new column called `Petal.Area` by multiplying `Petal.Length` and `Petal.Width` and assigning the product to `iris$Petal.Area`

```{r addcalculatedcolumn, exercise=T}
```

Note: Adding a calculated column like this is less error prone and more repeatable than doing it in Excel.....

You should store the data in a spreadsheet, and then manipulate it in R. 

## Functions 

### Where the rubber hits the road

Functions are the heart of R.

A function is just a series of commands that is assigned a name.  

Functions

> - accept **arguments**
> - perform a series of commands using the argument values
> - **return** a single object. 

You can create your own functions (and you will!) but there are many hundreds of pre-defined functions available for your use. 

**A huge part of the learning curve of R is learning which functions exist, which is why they invented google.com!** 

### Calling Functions

You call a function by typing its name, followed by parentheses containing 0 or more **arguments**. When you call a function, you should not include a space between the name of the function and the opening parenthesis.  

So this is good:
  * `function(x)`
And this is bad:
  * `function (x)`

Arguments are the way you pass data and/or options to a function. 

For example, the `paste()` function simply pastes together its arguments into a single text string. Try running this code to see the result of the `paste()` function

```{r pastefunctionexample, exercise=T}
part1 <- "The quick brown fox"
part2 <- "jumped over the lazy dog."
paste(part1, part2)
```

**Note**: You can see all the arguments and default values for any function using the `?` operator like this `?NameOfFunction`.

### Challenge

```{r parenthesisbrackets, echo=FALSE}
question("what is the correct way to use the print function to print the vector called x?",
  answer('print[x]', correct=F), 
  answer('print[[x]]', correct=F),
  answer('print (x)',correct=F),
  answer('print(x)',correct=T),
  random_answer_order = T, 
  allow_retry = T
)
```

## Congrats!

You have completed the intro to R tutorial!  Now we will switch to using R on our own computers.  


